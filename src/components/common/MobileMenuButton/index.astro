---
import { t, type Locale } from '../../../i18n/i18n';
import type { HeaderColorConfig } from '../../../config/headerColors';

export interface Props {
  currentLang: Locale;
  headerColorConfig?: HeaderColorConfig;
}

const { currentLang, headerColorConfig } = Astro.props;

// Traducciones
const openMenuLabel = t('menu_labels.open_main_menu', { namespace: 'common', locale: currentLang }) || 'Open main menu';

// SVG Icons
const menuIconSvg = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
</svg>`;

const closeIconSvg = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
</svg>`;

// Usar colores por defecto si no se proporciona configuración
const textColor = headerColorConfig?.textColor || 'text-white';
const hoverTextColor = headerColorConfig?.hoverTextColor || 'hover:text-gray-300';
const hoverBackgroundColor = headerColorConfig?.hoverBackgroundColor || 'hover:bg-blue-800';
---

<!-- Mobile Menu Button (visible up to md, hidden on lg and up) -->
<div class="xl:hidden">
  <button
    id="mobile-menu-button"
    type="button"
    class={`inline-flex items-center justify-center text-white p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white`}
    aria-expanded="false"
    aria-label={openMenuLabel}
  >
    <span class="sr-only">{openMenuLabel}</span>
    <div id="menu-icon-container" class="w-8 h-8 flex items-center justify-center" set:html={menuIconSvg}></div>
  </button>
</div>

<script is:inline>
  (function() {
    const menuIconSvg = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
</svg>`;

    const closeIconSvg = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
</svg>`;

    function initMobileMenuButton() {
      const menuButton = document.getElementById('mobile-menu-button');
      const menuIconContainer = document.getElementById('menu-icon-container');
      const mobileMenu = document.getElementById('mobile-menu');
      
      if (!menuButton || !menuIconContainer || !mobileMenu) {
        return;
      }

      // Evitar inicialización múltiple
      if (menuButton.dataset.initialized === 'true') {
        return;
      }
      menuButton.dataset.initialized = 'true';

      function handleClick(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const isHidden = mobileMenu.classList.contains('hidden');
        
        if (isHidden) {
          // Abrir menú
          mobileMenu.classList.remove('hidden');
          document.body.style.overflow = 'hidden';
          menuButton.setAttribute('aria-expanded', 'true');
          menuIconContainer.innerHTML = closeIconSvg;
        } else {
          // Cerrar menú
          mobileMenu.classList.add('hidden');
          document.body.style.overflow = '';
          menuButton.setAttribute('aria-expanded', 'false');
          menuIconContainer.innerHTML = menuIconSvg;
        }
      }

      menuButton.addEventListener('click', handleClick);
    }

    // Ejecutar inmediatamente si el DOM ya está cargado
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMobileMenuButton);
    } else {
      initMobileMenuButton();
    }

    // Reinicializar en navegación de Astro
    document.addEventListener('astro:page-load', initMobileMenuButton);
    document.addEventListener('astro:after-swap', () => {
      setTimeout(initMobileMenuButton, 50);
    });
  })();
</script>
