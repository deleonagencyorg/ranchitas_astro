---
import { getLocale } from '../../i18n/i18n';
import RecipeCard from './RecipeCard.astro';

interface RecipeItem {
  id: string;
  title: string;
  image?: string;
  preparation_time: number;
  difficulty?: string;
  servings?: number;
  rating?: number;
  product?: string | string[];
}

export interface Props {
  items: RecipeItem[];
}

const { items = [] } = Astro.props as { items: RecipeItem[] };
const currentLang = getLocale();
---

{items.length === 0 ? (
  <div class="w-full text-center text-gray-500 py-8">
    {currentLang === 'es' ? 'No hay recetas relacionadas.' : 'No related recipes.'}
  </div>
) : (
  <div class="w-full relative">
    <div class="swiper-container related-recipes-swiper">
      <div class="swiper-wrapper">
        {items.map((recipe) => (
          <div class="swiper-slide h-auto">
            <div class="h-full">
              <RecipeCard
                image={recipe.image || '/images/recipes/placeholder.jpg'}
                title={recipe.title}
                time={`${recipe.preparation_time}MIN`}
                id={recipe.id}
                product={Array.isArray(recipe.product) ? recipe.product[0] : recipe.product}
              />
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Navigation Arrows -->
    {items.length > 3 && (
      <>
        <button class="swiper-button-prev-related absolute left-0 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white shadow-lg flex items-center justify-center text-[#F86509] hover:bg-[#F86509] hover:text-white transition-colors z-10">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>
        <button class="swiper-button-next-related absolute right-0 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white shadow-lg flex items-center justify-center text-[#F86509] hover:bg-[#F86509] hover:text-white transition-colors z-10">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>
      </>
    )}
  </div>
)}

<script>
  import Swiper from 'swiper';
  import { Navigation, Autoplay } from 'swiper/modules';
  import 'swiper/css';
  import 'swiper/css/navigation';

  document.addEventListener('DOMContentLoaded', () => {
    const relatedSwiper = document.querySelector('.related-recipes-swiper');
    if (relatedSwiper) {
      new Swiper('.related-recipes-swiper', {
        modules: [Navigation, Autoplay],
        slidesPerView: 1,
        spaceBetween: 20,
        loop: false,
        autoplay: {
          delay: 4000,
          disableOnInteraction: false,
        },
        navigation: {
          nextEl: '.swiper-button-next-related',
          prevEl: '.swiper-button-prev-related',
        },
        breakpoints: {
          768: {
            slidesPerView: 2,
            spaceBetween: 30,
          },
          1024: {
            slidesPerView: 3,
            spaceBetween: 40,
          },
        },
      });
    }
  });

  document.addEventListener('astro:page-load', () => {
    const relatedSwiper = document.querySelector('.related-recipes-swiper');
    if (relatedSwiper) {
      new Swiper('.related-recipes-swiper', {
        modules: [Navigation, Autoplay],
        slidesPerView: 1,
        spaceBetween: 20,
        loop: false,
        autoplay: {
          delay: 4000,
          disableOnInteraction: false,
        },
        navigation: {
          nextEl: '.swiper-button-next-related',
          prevEl: '.swiper-button-prev-related',
        },
        breakpoints: {
          768: {
            slidesPerView: 2,
            spaceBetween: 30,
          },
          1024: {
            slidesPerView: 3,
            spaceBetween: 40,
          },
        },
      });
    }
  });
</script>

<style>
  .swiper-slide {
    height: auto;
    display: flex;
  }
  
  .swiper-slide > div {
    width: 100%;
  }
</style>
